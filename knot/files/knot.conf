{%- from "knot/map.jinja" import server with context %}

{% macro val(name,value) -%}
    {{ name }}: {% if value is string and value[0] != '[' %}"{{ value }}"{% else %}{{ value }}{% endif %}
{%- endmacro %}

server:
    listen: {{ server.bind.ipv4.address }}@{{ server.bind.ipv4.port }}
    listen: {{ server.bind.ipv6.address }}@{{ server.bind.ipv6.port }}
{%- if server.options is defined %}
    {%- for param_name, param_value in server.options.items() %}
    {{ val(param_name, param_value) }}
    {%- endfor %}
{%- endif %}

{%- if server.log is defined %}
log:
{%- for target_name, target in server.log.items() %}
  - target: {{ target }}
    {%- for param_name, param_value in target.items() %}
    {{ val(param_name, param_value) }}
    {%- endfor %}
{%- endfor %}
{%- endif %}

{%- if server.key is defined %}
key:
{%- for key_name, key in server.key.items() %}
  - id: {{ key_name }}
    {%- for param_name, param_value in key.items() %}
    {{ val(param_name, param_value) }}
    {%- endfor %}
{%- endfor %}
{%- endif %}


{%- if server.remote is defined %}
remote:
{%- for remote_name, remote in server.remote.items() %}
  - id: {{ remote_name }}
    {%- for param_name, param_value in remote.items() %}
    {{ val(param_name, param_value) }}
    {%- endfor %}
{%- endfor %}
{%- endif %}


{%- if server.acl is defined %}
acl:
{%- for acl_name, acl in server.acl.items() %}
  - id: {{ acl_name }}
    {%- for param_name, param_value in acl.items() %}
    {{ val(param_name, param_value) }}
    {%- endfor %}
{%- endfor %}
{%- endif %}


{%- if server.policy is defined %}
policy:
{%- for policy_name, policy in server.policy.items() %}
  - id: {{ policy_name }}
    {%- for param_name, param_value in policy.items() %}
    {{ val(param_name, param_value) }}
    {%- endfor %}
{%- endfor %}
{%- endif %}


{%- if server.template is defined %}
template:
{%- for template_name, template in server.template.items() %}
  - id: {{ template_name }}
    {%- for param_name, param_value in template.items() %}
    {{ val(param_name, param_value) }}
    {%- endfor %}
{%- endfor %}
{%- endif %}


{%- if server.zone is defined %}
zone:
{%- for zone_name, zone in server.zone.items() %}
  - domain: {{ zone_name }}
    {%- for param_name, param_value in zone.items() %}
    {%- if param_name != "records" and param_name != "soa" %}
    {{ val(param_name, param_value) }}
    {%- endif %}
    {%- endfor %}
{%- endfor %}
{%- endif %}
